# MariaFlow - Arquitetura do Sistema

*Documenta√ß√£o t√©cnica atualizada - 15/08/2025*

## Vis√£o Geral

O MariaFlow √© um sistema de gest√£o para franquias que implementa uma arquitetura hier√°rquica baseada em unidades, com controle granular de m√≥dulos e permiss√µes por n√≠vel de usu√°rio.

## Arquitetura de Permiss√µes Hier√°rquicas

### Sistema de 3 Camadas Implementado

```
üî¥ Super Admin (level: 100, is_super_admin: true)
    ‚îÇ
    ‚îú‚îÄ‚îÄ ‚úÖ Acesso total ao sistema
    ‚îú‚îÄ‚îÄ ‚úÖ Gest√£o de todas as unidades (Gest√£o Unidades)
    ‚îú‚îÄ‚îÄ ‚úÖ Super Admin Dashboard
    ‚îî‚îÄ‚îÄ ‚úÖ M√≥dulos da unidade ativa selecionada
    
üü° Admin (level: 80, role: "admin")
    ‚îÇ
    ‚îú‚îÄ‚îÄ ‚úÖ Administra√ß√£o de unidade espec√≠fica
    ‚îú‚îÄ‚îÄ ‚úÖ Gest√£o de usu√°rios da unidade
    ‚îî‚îÄ‚îÄ ‚úÖ Todos os m√≥dulos habilitados na unidade (unit_modules)
    
üü¢ Atendente (level: 30, role: "atendente")
    ‚îÇ
    ‚îú‚îÄ‚îÄ ‚úÖ Acesso granular por m√≥dulo espec√≠fico
    ‚îú‚îÄ‚îÄ ‚úÖ Apenas m√≥dulos liberados individualmente
    ‚îî‚îÄ‚îÄ ‚úÖ Configurado via user_module_permissions
```

### Fluxo de Dados de Permiss√µes

```
Database (unit_modules + user_module_permissions)
    ‚Üì
useActiveUnit.tsx (fonte √∫nica de verdade)
    ‚Üì 
useAllowedModules.tsx (filtra menu)
    ‚Üì
AppSidebarMenu.tsx (renderiza sidebar)
```

## Database Schema Completo

### Tabelas Principais

```sql
-- Roles do sistema
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR UNIQUE NOT NULL,
    display_name VARCHAR NOT NULL,
    level INTEGER NOT NULL, -- 30: Atendente, 80: Admin, 100: Super Admin
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT now()
);

-- Usu√°rios principais
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR UNIQUE NOT NULL,
    nome VARCHAR NOT NULL,
    password VARCHAR, -- Hash bcrypt
    role_id UUID REFERENCES roles(id),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- Super admins (controle especial)
CREATE TABLE super_admins (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now()
);

-- Unidades/Filiais
CREATE TABLE units (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR NOT NULL,
    code VARCHAR UNIQUE,
    address TEXT,
    phone VARCHAR,
    email VARCHAR,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    created_by UUID REFERENCES users(id)
);

-- M√≥dulos do sistema
CREATE TABLE modules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR UNIQUE NOT NULL, -- "dashboard", "clientes", "agenda", etc.
    display_name VARCHAR NOT NULL, -- "Dashboard", "Clientes", "Agenda", etc.
    description TEXT,
    icon VARCHAR, -- Nome do √≠cone
    category VARCHAR, -- "core", "atendimento", "comercial", etc.
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now()
);

-- ‚úÖ IMPLEMENTADO: M√≥dulos permitidos por unidade (para Admin)
CREATE TABLE unit_modules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    unit_id UUID REFERENCES units(id) ON DELETE CASCADE,
    module_id UUID REFERENCES modules(id) ON DELETE CASCADE,
    is_active BOOLEAN DEFAULT true,
    configured_at TIMESTAMPTZ DEFAULT now(),
    configured_by UUID REFERENCES users(id),
    UNIQUE(unit_id, module_id)
);

-- ‚úÖ IMPLEMENTADO: Vincula√ß√£o usu√°rio-unidade
CREATE TABLE user_unit_assignments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    unit_id UUID REFERENCES units(id) ON DELETE CASCADE,
    assigned_by UUID REFERENCES users(id) ON DELETE SET NULL,
    role_override VARCHAR, -- Role espec√≠fica para esta unidade (opcional)
    is_primary BOOLEAN DEFAULT false,
    assigned_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(user_id, unit_id)
);

-- ‚úÖ IMPLEMENTADO: Permiss√µes espec√≠ficas de m√≥dulos para atendentes
CREATE TABLE user_module_permissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    module_id UUID REFERENCES modules(id) ON DELETE CASCADE,
    unit_id UUID REFERENCES units(id) ON DELETE CASCADE,
    granted_by UUID REFERENCES users(id) ON DELETE SET NULL,
    granted_at TIMESTAMPTZ DEFAULT now(),
    is_active BOOLEAN DEFAULT true,
    UNIQUE(user_id, module_id, unit_id)
);
```

-- Logs de atividade
CREATE TABLE activity_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE SET NULL,
    unit_id UUID REFERENCES units(id) ON DELETE SET NULL,
    action VARCHAR NOT NULL, -- "login", "create_user", "enable_module", etc.
    resource VARCHAR, -- "user", "unit", "module", etc.
    resource_id UUID, -- ID do recurso afetado
    details JSONB, -- Detalhes adicionais da a√ß√£o
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMPTZ DEFAULT now()
);
```

## Estrutura de M√≥dulos

### Mapeamento de M√≥dulos Implementado

```typescript
// Mapeamento entre IDs do menu frontend e nomes no banco
const MODULE_MAPPING = {
  'dashboard': 'Dashboard',
  'super-admin': 'Super Admin Dashboard', // Apenas Super Admin
  'gestao-unidades': 'Gest√£o Unidades',   // Apenas Super Admin
  'agenda': 'Agenda',
  'agendamentos': 'Agendamentos', 
  'clientes': 'Clientes',
  'pipeline': 'Pipeline',
  'tickets': 'Tickets',
  'profissionais': 'Profissionais',
  'financeiro': 'Financeiro',
  'cashback': 'Cashback',
  'materiais': 'Materiais',
  'materiais-marketing': 'Materiais Marketing',
  'uniformes': 'Uniformes',
  'publicacoes': 'Publica√ß√µes',
  'recrutadora': 'Recrutadora',
  'base-conhecimento': 'Base Conhecimento',
  'maria-uni': 'MariaUni',
  'configuracao-modulos': 'Configura√ß√£o M√≥dulos'
};
```

### Categorias de M√≥dulos por N√≠vel

```
üî¥ Super Admin Exclusivos:
‚îú‚îÄ‚îÄ Super Admin Dashboard - Vis√£o geral global
‚îî‚îÄ‚îÄ Gest√£o de Unidades - Controle de unidades

üü° M√≥dulos de Unidade (Admin + Atendente autorizado):
‚îú‚îÄ‚îÄ Core:
‚îÇ   ‚îî‚îÄ‚îÄ Dashboard - Vis√£o geral da unidade
‚îÇ
‚îú‚îÄ‚îÄ Atendimento:
‚îÇ   ‚îú‚îÄ‚îÄ Agenda - Sistema de agendamentos
‚îÇ   ‚îú‚îÄ‚îÄ Agendamentos - Gest√£o de agendamentos
‚îÇ   ‚îú‚îÄ‚îÄ Clientes - Cadastro e gest√£o de clientes
‚îÇ   ‚îú‚îÄ‚îÄ Pipeline - Gest√£o de leads e oportunidades
‚îÇ   ‚îî‚îÄ‚îÄ Tickets - Sistema de suporte
‚îÇ
‚îú‚îÄ‚îÄ Recursos Humanos:
‚îÇ   ‚îú‚îÄ‚îÄ Profissionais - Gest√£o de equipe
‚îÇ   ‚îî‚îÄ‚îÄ Recrutadora - Processo seletivo
‚îÇ
‚îú‚îÄ‚îÄ Financeiro:
‚îÇ   ‚îú‚îÄ‚îÄ Financeiro - Controle financeiro
‚îÇ   ‚îî‚îÄ‚îÄ Cashback - Programa de recompensas
‚îÇ
‚îú‚îÄ‚îÄ Marketing & Materiais:
‚îÇ   ‚îú‚îÄ‚îÄ Materiais - Gest√£o de materiais
‚îÇ   ‚îú‚îÄ‚îÄ Materiais Marketing - Materiais promocionais
‚îÇ   ‚îú‚îÄ‚îÄ Publica√ß√µes - Gest√£o de conte√∫do
‚îÇ   ‚îî‚îÄ‚îÄ Uniformes - Controle de uniformes
‚îÇ
‚îú‚îÄ‚îÄ Educa√ß√£o:
‚îÇ   ‚îú‚îÄ‚îÄ Base Conhecimento - Documenta√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ MariaUni - Sistema educacional
‚îÇ
‚îî‚îÄ‚îÄ Configura√ß√£o:
    ‚îî‚îÄ‚îÄ Configura√ß√£o M√≥dulos - Configura√ß√µes da unidade
```

## Hooks Principais Implementados

### useAuth.tsx - Autentica√ß√£o Pura

```typescript
interface User {
  id: string;
  email: string;
  nome: string | null;
  role: string;
  role_level: number;
  is_super_admin: boolean;
}

// ‚úÖ IMPLEMENTADO: Hook focado apenas em autentica√ß√£o
// - Remove l√≥gica de permiss√µes (movida para useActiveUnit)
// - Retorna dados b√°sicos do usu√°rio
// - Chama RPC authenticate_user com fallback SQL
```

### useActiveUnit.tsx - Fonte √önica de Verdade

```typescript
interface UnitModule {
  id: string;
  module_name: string;
  unit_id: string;
}

// ‚úÖ IMPLEMENTADO: Gerenciamento centralizado de permiss√µes
const useActiveUnit = () => {
  // Super Admin: loadUnitModules() - todos os m√≥dulos da unidade ativa
  // Admin: loadUnitModules() - m√≥dulos habilitados na unidade
  // Atendente: loadAtendantModules() - m√≥dulos espec√≠ficos liberados
  
  return {
    activeUnit,
    setActiveUnit,
    availableModules, // Array de m√≥dulos dispon√≠veis
    units,
    loading
  };
};
```

### useAllowedModules.tsx - Filtro de Menu

```typescript
// ‚úÖ IMPLEMENTADO: Filtragem hier√°rquica do menu
const useAllowedModules = () => {
  const { user } = useAuth();
  const { activeUnit, availableModules, loading } = useActiveUnit();
  
  // Super Admin: m√≥dulos super admin + m√≥dulos da unidade
  // Admin/Atendente: apenas m√≥dulos dispon√≠veis da unidade
  
  return {
    allowedModules, // MenuItems filtrados
    loading
  };
};
```

## L√≥gica de Permiss√µes por Tipo de Usu√°rio

### üî¥ Super Admin (level: 100)

```typescript
// Sempre inclui m√≥dulos especiais
const superAdminModules = ['super-admin', 'gestao-unidades'];

// Adiciona m√≥dulos da unidade ativa selecionada
const unitModules = availableModules.map(m => m.module_name);
const allModules = [...superAdminModules, ...unitModules];
```

### üü° Admin (level: 80)

```sql
-- Busca todos os m√≥dulos habilitados na unidade
SELECT m.name as module_name, um.unit_id
FROM unit_modules um
JOIN modules m ON m.id = um.module_id
WHERE um.unit_id = $1 AND um.is_active = true;
```

### üü¢ Atendente (level: 30)

```sql
-- Busca apenas m√≥dulos especificamente liberados
SELECT m.name as module_name, ump.unit_id
FROM user_module_permissions ump
JOIN modules m ON m.id = ump.module_id
WHERE ump.user_id = $1 
  AND ump.unit_id = $2 
  AND ump.is_active = true;
```
  role: string;
  is_super_admin?: boolean;
  unit_id?: string;
  unit_name?: string;
  allowed_modules?: string[]; // M√≥dulos permitidos para a unidade
}

// Funcionalidades implementadas:
// - Login com valida√ß√£o de credenciais
// - Carregamento autom√°tico de unidade e m√≥dulos
// - Detec√ß√£o de super_admin
// - Armazenamento em localStorage
// - Logs detalhados para debugging
```

### useAllowedModules.tsx

```typescript
// Filtro din√¢mico de m√≥dulos baseado nas permiss√µes:
// - Super Admin: Todos os m√≥dulos (bypass)
// - Outros roles: Apenas m√≥dulos da unidade
// - Mapeamento de IDs do menu para nomes no banco
// - Retorna menuItems filtrados

interface AllowedModulesReturn {
  allowedMenuItems: MenuItem[];
  isLoading: boolean;
}
```

## Fluxo de Autentica√ß√£o

```mermaid
graph TD
    A[Login Form] --> B[useAuth.login()]
    B --> C{Validar Credenciais}
    C -->|Inv√°lido| D[Erro de Login]
    C -->|V√°lido| E[Buscar Dados do Usu√°rio]
    E --> F{√â Super Admin?}
    F -->|Sim| G[Carregar Todos M√≥dulos]
    F -->|N√£o| H[Buscar Unidade do Usu√°rio]
    H --> I[Buscar M√≥dulos da Unidade]
    I --> J{Tem M√≥dulos?}
    J -->|N√£o| K[allowed_modules: vazio]
    J -->|Sim| L[Carregar Lista de M√≥dulos]
    G --> M[Montar Objeto User]
    K --> M
    L --> M
    M --> N[Salvar localStorage]
    N --> O[Redirecionar Dashboard]
```

## Componentes Principais

### AppSidebarMenu.tsx
- Renderiza√ß√£o din√¢mica baseada em useAllowedModules
- Estado de loading durante carregamento
- Fallback "Nenhum m√≥dulo dispon√≠vel" quando vazio
- Suporte completo a √≠cones e categorias

### GestaoUnidadesModule.tsx
- Interface completa para Super Admin
- 4 Abas: Dados, M√≥dulos, Usu√°rios, Logs
- CRUD completo de unidades
- Cria√ß√£o de usu√°rios como "Atendente" por padr√£o
- Configura√ß√£o de m√≥dulos por unidade
- Sistema de vincula√ß√£o usu√°rio-unidade

## Estado Atual - 15/08/2025

### ‚úÖ Funcionalidades Implementadas
- [x] Sistema de roles hier√°rquico (Super Admin > Admin > Atendente)
- [x] Database schema completo com foreign keys corretas
- [x] Interface de gest√£o de unidades com 4 abas
- [x] Cria√ß√£o autom√°tica de usu√°rios como "Atendente"
- [x] Vincula√ß√£o de usu√°rios √†s unidades (foreign key corrigida)
- [x] Hook useAuth com carregamento de permiss√µes
## Dados de Teste Configurados

### Usu√°rios de Teste

```sql
-- ‚úÖ CONFIGURADO: Usu√°rios para teste do sistema hier√°rquico
INSERT INTO users (id, email, nome, role_id) VALUES
('550e8400-e29b-41d4-a716-446655440001', 'jeanpetri@gmail.com', 'Jean Petri', '550e8400-e29b-41d4-a716-446655440003'), -- Super Admin
('550e8400-e29b-41d4-a716-446655440002', 'admin@mariaflow.com', 'Admin MariaFlow', '550e8400-e29b-41d4-a716-446655440002'), -- Admin
('550e8400-e29b-41d4-a716-446655440004', 'atendente@mariaflow.com', 'Atendente Teste', '550e8400-e29b-41d4-a716-446655440001'), -- Atendente
('550e8400-e29b-41d4-a716-446655440005', 'lucas@email.com', 'Lucas Silva', '550e8400-e29b-41d4-a716-446655440001'); -- Atendente
```

### Permiss√µes Espec√≠ficas Configuradas

```sql
-- ‚úÖ CONFIGURADO: Atendente com acesso a Dashboard + Clientes
atendente@mariaflow.com:
- Dashboard (unidade: MB Drome)
- Clientes (unidade: MB Drome)

-- ‚úÖ CONFIGURADO: Atendente com acesso estendido
lucas@email.com:
- Dashboard (unidade: MB Drome)
- Clientes (unidade: MB Drome)
- Agenda (unidade: MB Drome)
```

### M√≥dulos da Unidade (Admin)

```sql
-- ‚úÖ CONFIGURADO: MB Drome tem todos os m√≥dulos habilitados
Unit "MB Drome" modules:
- Dashboard, Agenda, Agendamentos, Clientes, Pipeline, Tickets
- Profissionais, Financeiro, Cashback, Materiais, Materiais Marketing
- Uniformes, Publica√ß√µes, Recrutadora, Base Conhecimento
- MariaUni, Configura√ß√£o M√≥dulos
```

## Status de Implementa√ß√£o

### ‚úÖ Funcionalidades Implementadas

- [x] **Database Schema Completo**: Todas as tabelas criadas e relacionadas
- [x] **Sistema de Roles**: 3 n√≠veis hier√°rquicos (Super Admin 100, Admin 80, Atendente 30)
- [x] **Super Admin System**: Controle total + m√≥dulos espec√≠ficos
- [x] **Admin Unit Modules**: Acesso a todos os m√≥dulos da unidade
- [x] **Atendente Permissions**: Controle granular por m√≥dulo individual
- [x] **Hook useAuth**: Autentica√ß√£o pura, dados b√°sicos do usu√°rio
- [x] **Hook useActiveUnit**: Fonte √∫nica de verdade para permiss√µes
- [x] **Hook useAllowedModules**: Filtro hier√°rquico do menu
- [x] **Hierarchical Logic**: L√≥gica diferenciada por tipo de usu√°rio
- [x] **Test Data**: Usu√°rios e permiss√µes configurados para teste
- [x] **Frontend Integration**: Sidebar renderiza m√≥dulos filtrados

### üîß Configura√ß√£o Atual

#### Sistema Funcionando
- **Super Admin**: V√™ m√≥dulos super admin + m√≥dulos da unidade ativa
- **Admin**: V√™ todos os m√≥dulos habilitados na unidade (unit_modules)
- **Atendente**: V√™ apenas m√≥dulos espec√≠ficos liberados (user_module_permissions)

#### Fluxo de Dados Validado
```
Login ‚Üí useAuth (user data) ‚Üí useActiveUnit (permissions) ‚Üí useAllowedModules (filter) ‚Üí Sidebar (render)
```

#### Queries Validadas
- **Super Admin**: Sempre inclui ['super-admin', 'gestao-unidades'] + m√≥dulos da unidade
- **Admin**: SELECT unit_modules WHERE unit_id = active_unit
- **Atendente**: SELECT user_module_permissions WHERE user_id + unit_id

### üéØ Pronto para Teste

**Usu√°rios para Testar**:
1. `jeanpetri@gmail.com` - Super Admin (deve ver todos os m√≥dulos)
2. `admin@mariaflow.com` - Admin (deve ver m√≥dulos da unidade)
3. `atendente@mariaflow.com` - Atendente (s√≥ Dashboard + Clientes)
4. `lucas@email.com` - Atendente (Dashboard + Clientes + Agenda)

**URL de Teste**: http://localhost:8081/

## Estrutura do Frontend

### Organiza√ß√£o de Arquivos
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/ (shadcn/ui components)
‚îÇ   ‚îú‚îÄ‚îÄ sidebar/ (navigation components)
‚îÇ   ‚îú‚îÄ‚îÄ AppSidebarMenu.tsx (renderiza√ß√£o hier√°rquica)
‚îÇ   ‚îú‚îÄ‚îÄ AgendaModule.tsx, ClientsModule.tsx, etc.
‚îÇ   ‚îî‚îÄ‚îÄ [outros m√≥dulos espec√≠ficos]
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.tsx (autentica√ß√£o)
‚îÇ   ‚îú‚îÄ‚îÄ useActiveUnit.tsx (permiss√µes - fonte √∫nica)
‚îÇ   ‚îú‚îÄ‚îÄ useAllowedModules.tsx (filtro de menu)
‚îÇ   ‚îî‚îÄ‚îÄ [outros hooks]
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ menuItems.ts (estrutura do menu)
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx (dashboard)
‚îÇ   ‚îî‚îÄ‚îÄ LoginPage.tsx
‚îî‚îÄ‚îÄ integrations/supabase/
    ‚îú‚îÄ‚îÄ client.ts
    ‚îî‚îÄ‚îÄ types.ts
```

### Tecnologias Utilizadas

**Frontend**:
- React 18 + TypeScript
- Vite (build tool)
- Tailwind CSS + shadcn/ui
- Lucide React (icons)

**Backend**:
- Supabase (BaaS)
- PostgreSQL
- Row Level Security (planejado)

**Desenvolvimento**:
- ESLint + TypeScript
- Git + GitHub

## Contas de Teste

### Super Admin
- **Email**: admin@sistema.com
- **Senha**: 123456
- **Acesso**: Todos os m√≥dulos + Gest√£o de Unidades

### Admin de Unidade
- **Email**: admin.filial1@sistema.com  
- **Senha**: 123456
- **Unidade**: Filial Centro
- **M√≥dulos**: Dashboard, Pipeline, Clientes

### Atendente
- **Email**: atendente.teste@sistema.com
- **Senha**: 123456
- **Unidade**: Filial Centro  
- **M√≥dulos**: Apenas Pipeline (PROBLEMA: vendo todos)

## Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos
- Node.js 18+
- Conta Supabase

### Setup Local
```bash
# Clone do reposit√≥rio
git clone <repository-url>
cd mariaflow-projeto-main

# Instala√ß√£o de depend√™ncias  
npm install

# Configura√ß√£o do Supabase
# Copie .env.example para .env
# Configure VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY

# Executar migra√ß√µes
supabase db push

# Iniciar desenvolvimento
npm run dev
```

### Vari√°veis de Ambiente
```env
VITE_SUPABASE_URL=sua_url_supabase
VITE_SUPABASE_ANON_KEY=sua_chave_anonima
```

## Roadmap de Desenvolvimento

### Vers√£o 1.0 - B√°sica (Atual)
- [x] Sistema de autentica√ß√£o
- [x] Gest√£o de unidades (Super Admin)
- [x] Cria√ß√£o de usu√°rios
- [ ] **Filtro de m√≥dulos (CR√çTICO - em desenvolvimento)**

### Vers√£o 1.1 - Melhorias
- [ ] RLS policies completas
- [ ] Sistema de auditoria avan√ßado
- [ ] Interface responsiva mobile
- [ ] Testes automatizados

### Vers√£o 2.0 - Expans√£o
- [ ] App mobile
- [ ] APIs REST p√∫blicas
- [ ] Integra√ß√µes externas (WhatsApp, etc.)
- [ ] Sistema de relat√≥rios avan√ßado

## Debugging e Logs

### Console Logs Implementados
- useAuth: Login, carregamento de unidade e m√≥dulos
- useAllowedModules: Recebimento e filtragem de m√≥dulos
- AppSidebarMenu: Renderiza√ß√£o de itens filtrados

### Como Debugar
1. Abra as ferramentas do desenvolvedor
2. Fa√ßa login com usu√°rio de teste
3. Monitore console para fluxo de dados
4. Verifique localStorage para dados salvos

### Comandos √öteis
```sql
-- Verificar m√≥dulos de uma unidade
SELECT m.name, m.display_name 
FROM unit_modules um
JOIN modules m ON um.module_id = m.id
WHERE um.unit_id = 'uuid-da-unidade' AND um.is_active = true;

-- Verificar usu√°rio e unidade
SELECT u.email, u.name, uua.unit_id, un.name as unit_name
FROM users u
JOIN user_unit_assignments uua ON u.id = uua.user_id  
JOIN units un ON uua.unit_id = un.id
WHERE u.email = 'email@teste.com';
```

## Considera√ß√µes de Seguran√ßa

### Implementadas
- Hash de senhas (planejado com bcrypt)
- Valida√ß√£o de foreign keys no banco
- Separa√ß√£o de roles e permiss√µes

### Planejadas
- Row Level Security (RLS) policies
- Valida√ß√£o JWT mais robusta
- Rate limiting
- Auditoria completa de a√ß√µes

---

*Esta documenta√ß√£o reflete o estado atual do sistema em 15/08/2025. O problema cr√≠tico de filtro de m√≥dulos est√° sendo ativamente investigado com debugging extensivo implementado.*
